<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; }
        .container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #0001; padding: 32px; }
        .card { background: #f0f4f8; border-radius: 8px; padding: 24px; margin-top: 24px; box-shadow: 0 1px 4px #0001; }
        .form-group { margin-bottom: 16px; }
        label { display: block; margin-bottom: 6px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
        .btn { background: #1976d2; color: #fff; border: none; padding: 10px 24px; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn:hover { background: #125ea2; }
        .actions a { margin-right: 12px; color: #1976d2; text-decoration: none; }
        .actions a:hover { text-decoration: underline; }
        .team-members { margin-top: 16px; }
        .team-member { display: flex; gap: 12px; margin-bottom: 8px; }
        .team-member input { flex: 1; }
    </style>
    <script>
        let memberCount = 1;
        function addMember() {
            if (memberCount >= 5) return;
            memberCount++;
            const membersDiv = document.getElementById('team-members');
            const div = document.createElement('div');
            div.className = 'team-member';
            div.innerHTML = `<input name="members[${memberCount-1}].name" placeholder="Name" required> <input name="members[${memberCount-1}].rollNumber" placeholder="Roll Number" required> <input name="members[${memberCount-1}].email" placeholder="Email" required>`;
            membersDiv.appendChild(div);
        }
    </script>
</head>
<body>
<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 20px;">
        <div>
            <h2>Student Dashboard</h2>
            <span>Welcome, <b sec:authentication="name">User Email</b></span>
        </div>
        <form th:action="@{/logout}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="btn">Logout</button>
        </form>
    </div>

    <form action="/student/createTeam" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <div class="form-group">
            <label>Subject Name</label>
            <input type="text" name="subject" required>
        </div>
        <div class="form-group">
            <label>Group Number</label>
            <select name="groupNumber" required>
                <option value="">Select Group</option>
                <th:block th:each="i : ${#numbers.sequence(1,10)}">
                    <option th:value="${i}" th:text="${i}"></option>
                </th:block>
            </select>
        </div>
        <div class="form-group">
            <label>Progress (%)</label>
            <input type="number" name="progress" min="0" max="100" value="0" required>
        </div>
        <div class="form-group team-members" id="team-members">
            <div class="team-member">
                <input name="members[0].name" placeholder="Name" required>
                <input name="members[0].rollNumber" placeholder="Roll Number" required>
                <input name="members[0].email" placeholder="Email" required>
            </div>
        </div>
        <button type="button" class="btn" onclick="addMember()">Add Member</button>
        <button type="submit" class="btn">Create Team</button>
    </form>

    <div th:if="${teams != null}">
        <div th:each="team : ${teams}" class="card">
            <h3 th:text="${team.subject}"></h3>
            <p><b>Group:</b> <span th:text="${team.groupNumber}"></span></p>
            <p><b>Progress:</b> <span th:text="${team.progress}"></span>%</p>

            <div>
                <b>Members:</b>
                <ul>
                    <li th:each="m : ${team.members}">
                        <span th:text="${m.name}"></span> (<span th:text="${m.rollNumber}"></span>) - <span th:text="${m.email}"></span>
                    </li>
                </ul>
            </div>
            <div class="actions" th:if="${currentUserId} == ${team.creatorUserId}">
                <a th:href="@{'/student/updateTeam/' + ${team.id}}">Update</a>
                <a th:href="@{'/student/deleteTeam/' + ${team.id}}"
                   onclick="return confirm('Are you sure you want to delete this team?')">Delete</a>
            </div>
        </div>
    </div>
</div>
</body>
</html>